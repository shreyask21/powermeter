<!DOCTYPE HTML><html><head> <meta name="viewport" content="width=device-width, initial-scale=1"> <script src="highcharts.js"></script> <script src="dark-unica.js"></script> <style> body { background-color: #232426; min-width: 310px; max-width: 800px; height: 400px; margin: 0 auto; } h2 { color: #dcdcdc; font-family: Arial; font-size: 2.5rem; text-align: center; padding-bottom: 4px; } div.container { width: auto; height: auto; padding: 10px; display: block; } div.form { display: block; text-align: center; } #polling { position: relative; display: flex; flex-flow: column wrap; text-align: center; } form { display: inline-block; margin-left: auto; margin-right: auto; text-align: left; } body { font: helvetica; } #setpol { margin: auto; } #polinp { margin: auto; } #buttoncap { color: #dcdcdc; font-family: Arial; font-size: 2rem; text-align: center; } input { width: 300px; height: 30px; background-color: #232426; padding: 0.35em 1.2em; border: 0.1em solid #FFFFFF; margin: 0 0.3em 0.3em 0; border-radius: 0.12em; box-sizing: border-box; text-decoration: none; font-family: 'Roboto', sans-serif; font-weight: 300; color: #FFFFFF; text-align: center; } hr { border-top: 3px solid #dcdcdc; width: 100%; } button { background-color: #232426; display: inherit; width: 150px; height: 30px; padding: 0.35em 1.2em; border: 0.1em solid #FFFFFF; margin: 0 0.3em 0.3em 0; border-radius: 0.12em; box-sizing: border-box; text-decoration: none; font-family: 'Roboto', sans-serif; font-weight: 300; color: #FFFFFF; text-align: center; transition: all 0.2s; } button:hover { color: #000000; background-color: #FFFFFF; } @media all and (max-width:30em) { button { display: block; margin: 0.4em auto; } } </style></head><body> <h2>Power Meter</h2> <hr> <div id="chart-power" class="container"></div> <hr> <div id="chart-voltage" class="container"></div> <hr> <div id="chart-current" class="container"></div> <hr> <div id="polling"> <p id="buttoncap">Set Polling Rate</p> <input type="text" id="polinp" placeholder="Polling rate in milliseconds"><br> </div> <button type="button" id="setpol">Set</button> <hr> <div class="form"> <form> <p id="buttoncap">Change Calibration</p> <button type="button" id="setcala">16V 400mA</button> <button type="button" id="setcalb">32V 1A</button> <button type="button" id="setcalc">32V 2A</button> </form> </div></body><script> var pollrate = 1000; var powerChart = new Highcharts.Chart({ chart: { renderTo: 'chart-power' }, title: { text: 'Power Graph' }, series: [{ showInLegend: false, data: [] }], plotOptions: { line: { dataLabels: { enabled: true } }, series: { color: '#CC66FF' } }, xAxis: { type: 'datetime', dateTimeLabelFormats: { second: '%H:%M:%S' } }, yAxis: { title: { text: 'Power (mW)' } }, credits: { enabled: false } }); var voltageChart = new Highcharts.Chart({ chart: { renderTo: 'chart-voltage' }, title: { text: 'Voltage Graph' }, series: [{ showInLegend: false, data: [] }], plotOptions: { line: { dataLabels: { enabled: true } }, series: { color: '#3399FF' } }, xAxis: { type: 'datetime', dateTimeLabelFormats: { second: '%H:%M:%S' } }, yAxis: { title: { text: 'Voltage (V)' } }, credits: { enabled: false } }); var currentChart = new Highcharts.Chart({ chart: { renderTo: 'chart-current' }, title: { text: 'Current Graph' }, series: [{ showInLegend: false, data: [] }], plotOptions: { line: { dataLabels: { enabled: true } }, series: { color: '#CC0033' } }, xAxis: { type: 'datetime', dateTimeLabelFormats: { second: '%H:%M:%S' } }, yAxis: { title: { text: 'Current (mA)' } }, credits: { enabled: false } }); function getPower() { var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function () { if (this.readyState == 4 && this.status == 200) { var x = (new Date()).getTime(), y = parseFloat(this.responseText); if (powerChart.series[0].data.length > 40) { powerChart.series[0].addPoint([x, y], true, true, true); } else { powerChart.series[0].addPoint([x, y], true, false, true); } } }; xhttp.open("GET", "/power", true); xhttp.send(); } function getVoltage() { var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function () { if (this.readyState == 4 && this.status == 200) { var x = (new Date()).getTime(), y = parseFloat(this.responseText); if (voltageChart.series[0].data.length > 40) { voltageChart.series[0].addPoint([x, y], true, true, true); } else { voltageChart.series[0].addPoint([x, y], true, false, true); } } }; xhttp.open("GET", "/voltage", true); xhttp.send(); } function getCurrent() { var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function () { if (this.readyState == 4 && this.status == 200) { var x = (new Date()).getTime(), y = parseFloat(this.responseText); if (currentChart.series[0].data.length > 40) { currentChart.series[0].addPoint([x, y], true, true, true); } else { currentChart.series[0].addPoint([x, y], true, false, true); } } }; xhttp.open("GET", "/current", true); xhttp.send(); } var powinterval = setInterval(getPower, pollrate); var volinterval = setInterval(getVoltage, pollrate); var curinterval = setInterval(getCurrent, pollrate); var btn1 = document.getElementById("setcala"); btn1.addEventListener("click", function () { var xhttp = new XMLHttpRequest(); xhttp.open("GET", "/setcala", true); xhttp.send(); }); var btn2 = document.getElementById("setcalb"); btn2.addEventListener("click", function () { var xhttp = new XMLHttpRequest(); xhttp.open("GET", "/setcalb", true); xhttp.send(); }); var btn3 = document.getElementById("setcalc"); btn3.addEventListener("click", function () { var xhttp = new XMLHttpRequest(); xhttp.open("GET", "/setcalc", true); xhttp.send(); }); function startInterval(_interval) { intervalId = setInterval(_interval); } var btn4 = document.getElementById("setpol"); btn4.addEventListener("click", function () { pollrate = Number(document.getElementById("polinp").value); clearInterval(powinterval); clearInterval(volinterval); clearInterval(curinterval); powinterval = setInterval(getPower, pollrate); volinterval = setInterval(getVoltage, pollrate); curinterval = setInterval(getCurrent, pollrate); });</script></html>